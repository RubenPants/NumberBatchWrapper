"""Utilisation methods."""
import gzip
import re
import shutil
from pathlib import Path
from typing import Any, Optional, Set
from urllib.request import urlretrieve

from fold_to_ascii import fold
from tqdm import tqdm


def clean(x: str) -> str:
    """Default cleaning method, put text to lowercase, remove non-letters and folds to ASCII."""
    x = fold(x.lower())
    x = re.sub(r'[^a-z]', '', x)
    return x


def get_raw_nb_path(
        path: Path,
        version: str = '19.08',
) -> Path:
    """
    Load in the raw multilingual NumberBatch data.
    
    :param path: Folder where data is stored (or should be stored once downloaded)
    :param version: Version of Multilingual NumberBatch data to download, if not yet exists
    :return: Path pointing to unzipped Multilingual NumberBatch file
    """
    assert path.is_dir()
    download(path, version=version)  # Download file if not yet exists
    return path / f"numberbatch-{version}.txt"


def tqdm_hook(t: tqdm) -> Any:
    """Progressbar to visualisation downloading progress."""
    last_b = [0]
    
    def update_to(b: int = 1, bsize: int = 1, t_size: Optional[int] = None) -> None:
        if t_size is not None:
            t.total = t_size
        t.update((b - last_b[0]) * bsize)
        last_b[0] = b
    
    return update_to


def download(
        destination: Path,
        version: str = '19.08',
) -> None:
    """
    Download the multilingual NumberBatch data, as specified by the given version.

    :param destination: Destination path where downloaded result is stored
    :param version: Version of Multilingual NumberBatch data to download
    :return: Success of the download
    """
    # If already downloaded, return
    if (destination / f"numberbatch-{version}.txt").is_file():
        return
    
    # File does not yet exist, download it (can take a while)
    if not (destination / f"numberbatch-{version}.txt.gz").is_file():
        with tqdm(unit='B', unit_scale=True, unit_divisor=1024, miniters=1, desc=f"Downloading..") as pbar:
            urlretrieve(
                    f"https://conceptnet.s3.amazonaws.com/downloads/2019/numberbatch/numberbatch-{version}.txt.gz",
                    destination / f"numberbatch-{version}.txt.gz",
                    reporthook=tqdm_hook(pbar),
            )
    
    # Unzip the downloaded file to a txt document
    with tqdm(desc="Unzipping"):
        with gzip.open(destination / f"numberbatch-{version}.txt.gz", 'rb') as f_in:
            with open(destination / f"numberbatch-{version}.txt", 'wb') as f_out:
                shutil.copyfileobj(f_in, f_out)


def get_special_tokens() -> Set[str]:
    """Get a set of regularly occurring special tokens."""
    return {
        'Ï³', 'È‘', 'Ğ±', 'â€˜', 'æ›¸', '×”', 'à¦', 'ã¹', 'ï»¤', 'Ô›', 'ã‚', 'ğŸ‚¾', 'Ç', 'è¦‹', 'Î¼', 'å­', 'â˜²', 'Æ¿', 'ï»‹', 'ã›', 'È™', 'ã³',
        'ïº©', 'âšŠ', 'ã‚¯', 'æ®µ', 'È', 'é ­', 'ãŠ', 'å·±', 'â„¢', 'ãƒ§', 'Åº', 'æ«›', 'ç›®', 'ãƒ”', 'ïº€', 'Åˆ', 'ç”»', 'ğŸ‚»', 'í”„', 'å°', 'çµµ', 'å†—',
        'ã‚“', 'êŒ', 'á»£', 'Å‚', 'ï»“', '×œ', 'ïº˜', 'åˆ¸', 'Ä', 'Ä', 'É©', 'Å‘', 'á¸·', 'é«ª', 'â™ª', 'æ©Ÿ', 'â„§', 'åŠ', 'ã‚€', 'áº¡', 'ï»Œ', 'ïº ',
        'Â©', 'ïº¬', 'ğŸƒ›', 'ãˆ', 'Î½', 'ïº½', '×™', 'é£¯', 'Ù†', 'Ã¸', 'Ç˜', 'ã‚Š', 'Ìš', 'Ê°', 'ç ²', 'Î±', 'è', 'è¶³', 'áº£', 'é³¥', 'âš', 'â™¥',
        'â„', 'È›', 'ãª', 'ã‚¶', 'ã«', 'É²', 'å¸­', 'âœ”', 'Ì', 'ã¬', 'Ê”', 'éš', 'å¿ƒ', 'è³Š', 'Î¶', 'ç´™', 'Ê¹', 'â™‚', 'â—', 'Ï»', 'ï»­', 'Ë‘',
        'ïº¼', 'È•', 'ã£', 'ï»ƒ', 'æ…ˆ', 'â†—', 'ã‚£', 'ğŸƒ', 'á»¥', 'Ğ°', 'ç”²', 'áº±', 'ã°', 'ğ„¢', 'ï»¨', 'Ø©', 'ïº”', 'Ã¥', 'ã‚¬', 'æ³¢', 'èŠ±', 'è­°',
        'Ì‡', 'Ï‡', 'è®š', 'ï»¡', 'Ó©', 'É£', 'Å±', 'ã‚µ', 'â†˜', 'â ´', 'æ’ƒ', 'âœ“', 'á»Ÿ', 'æ³•', 'ï»', 'â„–', 'ï»€', 'é¦¬', 'Ï†', 'Â·', 'Ù', 'ã‚‚',
        'Ä¡', 'Ï›', '×', 'æ³£', 'æ³‰', 'è‰', 'â §', 'ï»®', 'á¹Ÿ', 'â ²', 'í•œ', 'ä»•', 'å¢ƒ', 'Ã¾', 'å®¶', 'â˜†', 'ç²§', 'ï»', 'â˜°', 'æˆŠ', 'æ°—', 'ã¨',
        'éš ', 'é…’', 'è‚‰', 'Ğº', 'Ğ¸', '×•', 'ï»˜', 'ã˜', 'ã¯', 'ïº', 'âšŒ', 'Ğµ', 'å ´', 'â˜¯', 'ïº±', 'ïº¨', 'ãƒ', 'â„¤', 'ï»', 'â™©', 'Î¾', 'æ',
        'è—¤', 'Ç”', '×¥', 'Ò«', 'ç³¸', 'å¯', 'é…‰', 'æ«‚', 'ï»¥', 'â š', 'æ•µ', '×–', 'ä¸‘', 'ÄŸ', 'Åµ', 'ğ„', 'è±¡', 'áµ', 'ä¼š', 'ïºµ', 'áµ£', 'ë‘',
        'à¤…', 'ç…™', 'ã†', 'é§•', 'Ù…', 'áº©', 'Ù„', 'â€™', 'Å¾', 'Î¸', 'È', 'ç¨‹', 'ê­“', 'Î¿', 'ïº·', 'Âº', 'Âª', 'ä¸‹', 'ã‚¤', 'Ê¾', 'æˆ¿', 'ãƒ£',
        'ïº‘', 'æœ‰', 'ãƒ‘', 'ã—', 'Éµ', 'åˆ', 'ã”', 'ãƒ‡', 'â˜³', 'å¡µ', 'å®¹', '×Ÿ', 'á»™', 'ã‚¢', 'ç”Ÿ', 'å¨', 'èˆ¹', 'éƒ½', 'ÊŠ', 'Å›', 'Ø±', 'ïº¯',
        'éœ§', 'Ä—', 'Î·', 'á»‰', 'å­¦', 'ïºŸ', 'Â°', 'é£Ÿ', '×š', 'ÅŸ', 'Å¡', 'á»«', 'Ì“', 'ã‚ˆ', 'è¡›', 'æ¨©', 'ïº', 'ã¸', 'âš', 'ç¥', 'éº¦', 'à¤¼',
        'áº¿', 'é­š', 'Ğ¼', 'â„€', 'æ¼”', 'ç«', 'ïº²', 'ï»š', 'ãƒ­', 'æ½œ', 'ï» ', 'ã', 'É¨', 'è¡£', 'ìŠ¤', 'Å«', 'æ­»', 'è–ª', 'ã‚º', 'Ä‘', 'ïº´', 'ã‚³',
        'â˜¥', 'ï»•', 'å•', 'ï¹»', 'Ñ‘', 'æ–™', 'â„Ÿ', 'ã‚‹', 'ï»', 'ã“', 'èƒƒ', 'ï»™', 'â˜·', 'Æ¶', 'â ‰', 'ã‚Œ', 'ãƒ‰', 'ğŸƒ', 'ã‚…', 'Ñ‡', 'Êƒ', 'å±±',
        'ï»¦', 'ç©º', '×¦', 'æ¥­', 'ÑŒ', 'ïº°', 'â˜‰', 'Æ´', 'å…‰', 'ïº®', 'à°', 'á»', 'ãƒ—', 'á¹­', 'ç†', '×›', 'ã‚¿', 'â ', 'Å', 'Ì€', 'å®‰', 'ã²',
        'Ä±', 'ã', 'Ù‰', 'ç£', 'å·³', 'â”€', 'ï»', 'Í‚', '×©', 'Ùˆ', 'Ã­', 'ïº–', 'Æ’', 'ç‚‰', 'ïº¿', 'é‹¤', 'éŸ³', 'ãƒ³', 'è«‡', 'ÑŠ', 'å²', 'æˆŒ',
        'å¿«', 'ï»', 'ğŸƒ‹', 'Ç', 'Î»', 'Îº', 'ï»–', 'æ±½', 'á»ƒ', 'â ˆ', 'ãƒ©', 'ãƒœ', 'ïº•', 'ïº³', 'ğŸšƒ', 'Å„', 'èª', 'é€£', 'èˆ', 'ç± ', 'ì–´', 'è©±',
        'Ì†', 'å½¢', 'ïºº', 'ì„', 'ïº¹', 'ï»£', 'è‰¦', 'á»±', 'ğŸƒ', 'Ì', '×˜', 'Ä©', 'ïº¸', 'å‚µ', 'ãƒ“', 'ïº’', 'Îµ', 'ãƒ†', 'Ê‹', 'Å£', 'å­—', 'å¯…',
        'Ğ»', 'ã‚ª', '\u200d', 'êµ', 'â ', 'Â®', 'è¾›', 'á±š', 'â˜±', '×¡', 'Ä“', 'åŒ–', 'êµ­', 'è§¦', 'æµ·', 'Å“', 'â ’', 'ã‘', 'ã¾', 'å£°', 'ïº§',
        'è‘¬', 'Ê’', 'âœ¡', 'É‚', 'â ¨', 'âš', '×¨', 'ä¸', 'æŒ‡', 'æ±', 'ï»œ', 'ç„¡', 'Æ¡', 'Ì„', 'ÙŠ', 'â™ ', 'Ğ¾', 'Å¼', 'å£¬', 'Ïˆ', 'å™Œ', 'é¶´',
        'åŠ‡', 'å–¶', 'é¢¨', '×¢', 'åˆ—', 'å', 'Ê³', 'é¸›', 'Å', 'å¥³', 'å°', 'ãƒ¬', 'Ø¨', 'â ¤', 'å¯¸', 'áº¯', 'Ğ·', '×’', 'ãƒ¯', 'å››', 'Ë', 'à¬',
        'ï»Ÿ', 'åºš', 'â ', 'ïº', '×', 'ïº¶', 'é–¢', 'àª', 'Î³', 'å¼', 'á±¢', 'â˜µ', 'å‹¢', 'è¨ˆ', 'à¤°', 'Çƒ', 'æœ', 'ïº“', 'Æ°', 'Ì', 'ïº¥', 'çµ¡',
        'Ï„', 'áº­', 'ã‚­', 'Ç‚', '× ', 'Øª', '×—', 'ï»ª', 'â˜´', 'æº€', 'ç¥', 'ãƒ¼', 'ã‚„', 'à¤', 'á»¯', 'Ä…', 'éœ°', 'å¤«', 'ã„', 'ã‚‰', 'ï»—', 'ïº',
        'çŸ¢', 'ï»§', 'è°·', 'ïº—', 'ã€†', 'â„£', 'ğŸƒ', 'æµ…', 'Ãµ', 'Ò“', 'ã®', 'ã‚·', 'â˜ƒ', 'ãƒ', 'à¤—', 'ïº¦', 'Ñ…', 'è‘‰', 'Ğ´', 'ä¼Š', 'ç”°', 'áµ‰',
        'ä¸™', 'É™', 'äº¥', 'è‚´', 'ã‚°', 'æ°´', 'æ¡', 'å°Š', 'ç”³', 'ç™¸', 'ïº­', 'é¦™', 'ã§', 'è€…', 'æ—', 'ç‰©', 'ï»', 'Ø§', '×¤', 'å±', 'æ•¬', 'ã‚ƒ',
        'Ï', 'ï»„', 'è©', 'â —', 'ä¸¡', 'â„µ', 'áº§', 'È…', 'å¹´', 'ïºª', 'å¦»', 'å±‹', 'â™¦', 'é­”', 'ïº', 'à¥', 'ã¦', 'â™€', 'Ñ', 'Å­', 'å¤§', 'æ±Ÿ',
        'Î´', 'Ç«', 'á±¡', 'ãƒš', 'ç¦', 'ã‚', 'ïº¾', 'ã™', 'ãƒ›', 'â ‡', 'æœª', 'ä»Š', 'à¨', 'á±Ÿ', 'ä¹™', 'Äƒ', 'á»“', 'åº¦', 'ç—›', 'é¡”', 'â™«', 'Ã±',
        'Ñƒ', 'è¾°', 'â™®', 'æ«“', 'ãƒ«', 'ï»©', '×', 'å®¿', 'Ê»', 'â€¿', 'Ç', 'â˜¶', 'å§¿', 'âŒ€', 'è¡¿', 'ã‚’', 'Ñ', 'å‚·', 'Ä™', 'â„‚', 'Ñˆ', 'Ì',
        'ğŸ‚«', 'Éš', 'ï»¬', 'ã ', 'è»Š', 'æœˆ', 'Ã½', 'ğŸ‚­', 'æƒ‘', 'ğŸ‚½', 'ê¸€', 'ç‰›', 'ç¢º', 'è·', 'ç†±', 'Ã³', 'Ñ', 'ç‹¼', 'Î¹', 'ã€’', 'Å‹', 'å¸¯',
        'ã¼', '×ª', 'é¶', 'æˆ¦', 'å¯', 'Ïƒ', 'çƒ', 'æŸ', 'ãƒª', 'ä½“', 'å›½', 'ï»¯', 'ç‹', 'Ğ½', 'é›»', 'âš‹', 'É“', 'ï»¢', 'ãŸ', 'æ¥½', 'Ñ‚', 'âš·',
        'å‰', 'â™£', '×‘', 'ã‚¹', 'ãš', 'ï»›', 'á»‹', 'æ˜Ÿ', 'â ›', 'Å™', 'ï»«', 'ï»Š', 'ğ„¡', 'áº¥', 'à¥', 'Ï‰', 'æ˜ ', 'â™­', 'Å', 'á± ', '\u200e',
        'ãƒ', 'æª', 'ãƒ˜', 'ïº«', 'á»', 'Ï€', 'ï»°', 'Ã¬', 'á¸³', 'ãŒ', 'â„', 'â—Œ', 'á»‡', 'ğŸ‚®', 'Î²', 'Ã£', 'ç§˜', 'å…·', 'È‰', 'ï»‚', '×“', 'å‘³',
        'Ä«', 'æ‹³', 'å¾Œ', 'é¯¨', 'â“š', 'ï»’', '×£', 'Ã°', 'åˆ', 'Ø¡', 'Ï…', 'ï»”', 'á»', 'æ–‡', 'ã¤', 'â ™', 'æ¯’', 'Ñ³', 'ã‹', 'Ñ€', 'ã¿', 'äº‹',
        'É›', 'Ø¹', 'ï»‘', 'Ğ²', 'Ò¯', 'É”', 'å‰²', 'ïº»', 'å', 'Å©', 'Éœ', 'Ì‚', 'Ê¿', 'á¹£', 'á»',
    }


def get_numbers() -> Set[str]:
    """Get a set of numbers (as strings)."""
    return {'0', '1', '2', '3', '4', '5', '6', '7', '8', '9'}


def get_symbols() -> Set[str]:
    """Get a set of symbols."""
    return {' ', '"', '#', "'", '.', '_', 'Ç€'}
